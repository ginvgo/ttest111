<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>项目展示</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <a href="/" class="brand">MyLab</a>
        <!-- 搜索区域 -->
        <div style="position:relative; width: 100%; max-width: 400px;">
            <div class="search-box">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                <input type="text" id="searchInput" class="search-input" placeholder="全局搜索项目..." oninput="filterProjects()">
                <button id="clearSearch" onclick="clearSearch()" style="display:none; position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; color:#999;">✕</button>
            </div>
            <div id="searchResultHint" style="position:absolute; top: 100%; left: 10px; font-size: 0.8rem; color: #666; margin-top: 4px;"></div>
        </div>
        <div class="nav-links">
            <a href="https://github.com/yourname" target="_blank">GitHub</a>
        </div>
    </nav>

    <div class="container">
        <header style="text-align: center; margin: 4rem 0;">
            <h1>Project Portfolio</h1>
        </header>

        <main id="project-list" class="project-grid">
            <!-- PROJECT_LIST_START -->

      <article class="project-card" data-name="number1">
        <div class="card-icon locked"><svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>
        <h3 class="card-title">number1</h3>
        <div class="card-meta">
            需要密码访问
        </div>
        <div class="card-actions">
          <button onclick="handleAccess('number1', true)" class="btn btn-primary btn-sm">访问</button>
          <button onclick="showPlanetInfo()" class="btn btn-outline btn-sm">知识星球</button>
          
        </div>
      </article>
    
<!-- PROJECT_LIST_END -->
        </main>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal-overlay">
        <div class="modal-box">
            <div style="text-align: center;">
                <h3 id="modalProjectName">受限项目</h3>
                <p style="color:#666; font-size:0.9rem; margin-bottom:1rem;">请输入密码访问。</p>
            </div>
            <div class="form-group">
                <input type="password" id="accessPassword" class="form-input" placeholder="Password">
                <div style="margin-top: 10px; display: flex; align-items: center; justify-content: space-between;">
                    <label style="font-size: 0.9rem; cursor: pointer; display: flex; align-items: center;">
                        <input type="checkbox" id="chkRemember" style="margin-right: 5px;"> 记住密码
                        <span id="rememberDuration" style="font-size:0.8rem; color:#999; margin-left:4px;">(30天)</span>
                    </label>
                </div>
                <div id="pwdError" style="color:red; font-size:0.85rem; display:none; margin-top:5px;">密码错误</div>
            </div>
            <div style="display:flex; gap:10px; margin-top:1.5rem;">
                <button onclick="closeModal()" class="btn btn-outline" style="flex:1;">取消</button>
                <button onclick="verifyPassword()" class="btn btn-primary" style="flex:1;">进入</button>
            </div>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        function filterProjects() {
            const val = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.project-card');
            const clearBtn = document.getElementById('clearSearch');
            const hint = document.getElementById('searchResultHint');
            
            clearBtn.style.display = val ? 'block' : 'none';
            
            let count = 0;
            cards.forEach(card => {
                const name = card.getAttribute('data-name');
                if (name && name.includes(val)) {
                    card.style.display = 'flex';
                    count++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            if (val) {
                hint.innerText = `找到 ${count} 个相关项目`;
            } else {
                hint.innerText = '';
            }
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            filterProjects();
        }

        // Auth Logic
        function getCookie(name) {
            const v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
            return v ? v[2] : null;
        }

        function handleAccess(folder, isEncrypted) {
            if (!isEncrypted) {
                window.location.href = `/projects/${folder}/index.html`;
                return;
            }
            
            // Check cookie
            if (getCookie(`access_${folder}`) === 'ok') {
                window.location.href = `/projects/${folder}/index.html`;
                return;
            }

            window.currentFolder = folder;
            document.getElementById('modalProjectName').innerText = folder;
            document.getElementById('accessPassword').value = '';
            document.getElementById('chkRemember').checked = false;
            document.getElementById('pwdError').style.display = 'none';
            document.getElementById('passwordModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('passwordModal').classList.remove('active');
        }

        async function verifyPassword() {
            const password = document.getElementById('accessPassword').value;
            const remember = document.getElementById('chkRemember').checked;
            
            const res = await fetch('/api/verify', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ folderName: window.currentFolder, password, remember })
            });

            const data = await res.json();
            if (data.success) {
                window.location.href = `/projects/${window.currentFolder}/index.html`;
            } else {
                document.getElementById('pwdError').style.display = 'block';
            }
        }
    </script>
</body>
</html>
